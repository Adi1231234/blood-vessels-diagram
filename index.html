<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>×›×œ×™ ×“× - ×× ×˜×•××™×”</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Heebo', sans-serif; background: #1a1a2e; color: #eee; }
  h1 { text-align: center; padding: 16px 10px 4px; font-size: 1.4em; }
  .tab-bar { display: flex; justify-content: center; gap: 8px; padding: 8px; }
  .tab-bar button {
    padding: 10px 24px; border: none; border-radius: 20px;
    font-family: inherit; font-size: 1em; cursor: pointer;
    background: #333; color: #aaa; transition: all 0.2s;
  }
  .tab-bar button.active-art { background: #8B0000; color: #fff; }
  .tab-bar button.active-vein { background: #1A5276; color: #fff; }
  .diagram-area {
    position: relative;
    width: 100%; height: calc(100vh - 110px); height: calc(100dvh - 110px);
    overflow: hidden; background: #fff; touch-action: none;
  }
  .diagram-area svg { position: absolute; top: 0; left: 0; }
  .controls {
    position: absolute; bottom: 12px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 6px; z-index: 10;
  }
  .controls button {
    width: 44px; height: 44px; border-radius: 50%; border: none;
    background: rgba(0,0,0,0.6); color: #fff; font-size: 1.4em;
    cursor: pointer; backdrop-filter: blur(4px);
  }
  .hidden { display: none; }
  .loading { display: flex; align-items: center; justify-content: center; height: 100%; color: #333; font-size: 1.2em; }
</style>
</head>
<body>

<h1>ğŸ«€ ×›×œ×™ ×”×“× - ×‘×˜×Ÿ ×•××’×Ÿ</h1>
<p style="text-align:center;color:#f88;font-size:0.95em;padding:0 10px 4px;">×‘×”×¦×œ×—×” ×™×¤×” ×©×œ×™ ××ª ×”×›×™ ×˜×•×‘×” ×‘×¢×•×œ×!!! â¤ï¸â¤ï¸â¤ï¸</p>

<div class="tab-bar">
  <button id="btn-veins" onclick="showTab('veins')">ğŸ”µ ×•×¨×™×“×™×</button>
  <button id="btn-arteries" onclick="showTab('arteries')" class="active-art">ğŸ”´ ×¢×•×¨×§×™×</button>
</div>

<div class="diagram-area" id="diagram-area">
  <div class="loading" id="loading-msg">×˜×•×¢×Ÿ ×ª×¨×©×™×...</div>
</div>

<div class="controls">
  <button onclick="zoomBy(0.7)" title="×”×§×˜×Ÿ">âˆ’</button>
  <button onclick="resetZoom()" title="××™×¤×•×¡">âŸ³</button>
  <button onclick="zoomBy(1.4)" title="×”×’×“×œ">+</button>
</div>

<script type="module">
import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
mermaid.initialize({ startOnLoad: false, securityLevel: 'loose', flowchart: { useMaxWidth: false } });

const definitions = {
  arteries: `%%{init: {'theme':'base','themeVariables':{'fontSize':'14px','fontFamily':'Heebo, Arial','lineColor':'#999'}}}%%
flowchart LR
    classDef aorta fill:#8B0000,color:#fff,stroke:#555,stroke-width:3px
    classDef major fill:#B22222,color:#fff,stroke:#555,stroke-width:2px
    classDef branch fill:#CD5C5C,color:#fff,stroke:#777,stroke-width:1px
    classDef sub fill:#E8967A,color:#222,stroke:#999,stroke-width:1px
    classDef tiny fill:#FDDCB5,color:#333,stroke:#bbb,stroke-width:1px

    A["ğŸ«€ Abdominal Aorta<br/>T12-L4"]:::aorta
    A --> IP["Inf. Phrenic A."]:::branch
    IP --> SSR["Sup. Suprarenal"]:::sub
    A --> LUM["Lumbar A. x4"]:::branch
    A --> MSR["Mid. Suprarenal"]:::branch
    A --> REN["Renal A."]:::major
    REN --> ISR["Inf. Suprarenal"]:::sub
    REN --> ANT4["Anterior 4 Seg."]:::sub
    REN --> POST1["Posterior 1 Seg."]:::sub
    A --> GON["Gonadal A.<br/>(Testicular/Ovarian)"]:::branch
    A --> OVA["Ovarian A."]:::branch
    A --> CT["Celiac Trunk<br/>T12"]:::major
    CT --> LGA["L. Gastric"]:::branch
    LGA --> LGAE["Esoph. br."]:::tiny
    CT --> CHA["Common Hepatic"]:::branch
    CHA --> HAPr["Hepatic Proper"]:::sub
    HAPr --> RGA["R. Gastric"]:::tiny
    HAPr --> LHA["L. Hepatic"]:::tiny
    HAPr --> RHA["R. Hepatic"]:::tiny
    RHA --> CysA["Cystic A."]:::tiny
    CHA --> GDA["Gastroduodenal"]:::sub
    GDA --> RGOA["R. Gastro-omental"]:::tiny
    GDA --> SPDA["Sup. Pancreaticod."]:::tiny
    CT --> SPA["Splenic A."]:::branch
    SPA --> LGOA["L. Gastro-omental"]:::tiny
    SPA --> SGA["Short Gastric"]:::tiny
    SPA --> DPA["Pancreatic br."]:::tiny
    SPA --> DORSPANC["Dorsal Pancreatic A."]:::tiny
    A --> SMA["SMA<br/>L1"]:::major
    SMA --> IPDA["Inf. Pancreaticod."]:::sub
    SMA --> JEJ["Jejunal A."]:::sub
    JEJ --> ARC["Arcades â†’ Vasa Recta"]:::tiny
    SMA --> ILC["Ileocolic"]:::sub
    ILC --> APPA["Appendicular A."]:::tiny
    SMA --> RCA["R. Colic"]:::sub
    SMA --> MCA["Mid. Colic"]:::sub
    A --> IMA["IMA<br/>L3"]:::major
    IMA --> LCA["L. Colic"]:::sub
    IMA --> SIGA["Sigmoid A."]:::sub
    IMA --> SRA["Sup. Rectal"]:::sub
    MCA -.->|"Marginal A.<br/>anastomosis"| LCA
    A --> MSAR["Median Sacral"]:::branch
    A --> CIA["Common Iliac"]:::major
    CIA --> EIA["External Iliac"]:::branch
    EIA --> FEM["Femoral A."]:::sub
    EIA --> INFE["Inf. Epigastric"]:::sub
    INFE --> CREMA["Cremasteric A."]:::tiny
    SUPE["Sup. Epigastric<br/>(â† Int. Thoracic)"]:::sub -.->|"anastomosis"| INFE
    CIA --> IIA["Internal Iliac"]:::branch
    IIA --> SGLUT["Sup. Gluteal"]:::sub
    IIA --> IGLUT["Inf. Gluteal"]:::sub
    IIA --> OBTA["Obturator"]:::sub
    IIA --> ILIOLUM["Iliolumbar A."]:::sub
    IIA --> LATSAC["Lateral Sacral A."]:::sub
    IIA --> INPUD["Int. Pudendal"]:::sub
    INPUD --> INFRA["Inf. Rectal"]:::tiny
    INPUD --> PERINA["Perineal A."]:::tiny
    INPUD --> DORSPA["Dorsal A. Penis/Clitoris"]:::tiny
    INPUD --> DEEPPA["Deep A. of Penis"]:::tiny
    INPUD --> BULBA["A. to Bulb"]:::tiny
    IIA --> IVA["Inf. Vesical"]:::sub
    IVA --> VASDEFA["A. to Vas Deferens"]:::tiny
    IIA --> MRA["Mid. Rectal"]:::sub
    IIA --> UTA["Uterine A."]:::sub
    UTA --> ARCA["Arcuate A."]:::tiny
    ARCA --> RADA["Radial A."]:::tiny
    RADA --> SPIRA["Spiral A."]:::tiny
    IIA --> VAGA["Vaginal A."]:::sub`,

  veins: `%%{init: {'theme':'base','themeVariables':{'fontSize':'14px','fontFamily':'Heebo, Arial','lineColor':'#7899B0'}}}%%
flowchart RL
    classDef ivc fill:#0D1B5E,color:#fff,stroke:#555,stroke-width:3px
    classDef major fill:#1A5276,color:#fff,stroke:#555,stroke-width:2px
    classDef portal fill:#512E5F,color:#fff,stroke:#555,stroke-width:2px
    classDef branch fill:#2E86C1,color:#fff,stroke:#777,stroke-width:1px
    classDef sub fill:#85C1E9,color:#222,stroke:#999,stroke-width:1px
    classDef liver fill:#1E8449,color:#fff,stroke:#555,stroke-width:2px
    classDef anas fill:#F39C12,color:#222,stroke:#777,stroke-width:2px

    IVC["ğŸ«€ IVC"]:::ivc
    HV["Hepatic V."] --> IVC
    RV["Renal V."] --> IVC
    IPV["Inf. Phrenic V."] --> IVC
    LV["Lumbar V. x4"] --> IVC
    TVR["R. Testicular/Ovarian V."] --> IVC
    TVL["L. Testicular/Ovarian V."] --> RV
    ILCV["Common Iliac V."] --> IVC
    EILV["External Iliac"] --> ILCV
    IILV["Internal Iliac"] --> ILCV
    FEMV["Femoral V."] --> EILV
    PAMPV["Pampiniform Plexus"]:::sub --> TVR
    PAMPV2["Pampiniform Plexus"]:::sub --> TVL
    LIVER["Liver Sinusoids"]:::liver --> HV
    CENTV["Central Veins"]:::sub --> HV
    PV["Portal Vein<br/>70% blood"]:::portal --> LIVER
    HAP["Hepatic A.<br/>30% O2"]:::sub --> LIVER
    SMV["SMV"]:::major --> PV
    SPLV["Splenic V."]:::major --> PV
    LLGV["L. Gastric V."]:::branch --> PV
    RRGV["R. Gastric V."]:::branch --> PV
    PDV["Pancreaticod. V."]:::branch --> PV
    IMV["IMV"]:::major --> SPLV
    SRV["Sup. Rectal V."]:::portal --> IMV
    MRV["Mid. Rectal V."]:::branch --> IILV
    IRV["Inf. Rectal V."]:::branch --> IILV
    INTPUDV["Int. Pudendal V."]:::branch --> IILV
    PROSTV["Prostatic Venous Plexus"]:::sub --> IILV
    DORSPENV["Deep Dorsal V. Penis"]:::sub --> PROSTV
    RECPLXV["Rectal Venous Plexus"]:::sub --> SRV
    RECPLXV --> MRV
    AN1["1. ×“×œ×™×•×ª ×•×•×©×˜ âš ï¸"]:::anas
    AN2["2. ×˜×—×•×¨×™×"]:::anas
    AN3["3. Caput Medusa<br/>(Paraumbilical V.)"]:::anas
    AN4["4. Retroperitoneal"]:::anas`
};

const svgCache = {};
const area = document.getElementById('diagram-area');
let currentSvg = null;

// Pan-zoom state
let scale = 1, tx = 0, ty = 0;
let isPanning = false, startX, startY, startTx, startTy;
let lastPinchDist = 0, pinchStartScale = 1;

function applyTransform() {
  if (!currentSvg) return;
  currentSvg.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
  currentSvg.style.transformOrigin = '0 0';
}

window.zoomBy = function(factor) {
  const rect = area.getBoundingClientRect();
  const cx = rect.width / 2, cy = rect.height / 2;
  const newScale = Math.max(0.1, Math.min(20, scale * factor));
  tx = cx - (cx - tx) * (newScale / scale);
  ty = cy - (cy - ty) * (newScale / scale);
  scale = newScale;
  applyTransform();
};

window.resetZoom = function() { fitToView(); };

function fitToView() {
  if (!currentSvg) return;
  const rect = area.getBoundingClientRect();
  const svgW = currentSvg.viewBox.baseVal.width || currentSvg.getBBox().width;
  const svgH = currentSvg.viewBox.baseVal.height || currentSvg.getBBox().height;
  scale = Math.min(rect.width / svgW, rect.height / svgH) * 0.95;
  tx = (rect.width - svgW * scale) / 2;
  ty = (rect.height - svgH * scale) / 2;
  applyTransform();
}

// Pointer events for pan
area.addEventListener('pointerdown', e => {
  if (e.pointerType === 'touch' && e.isPrimary === false) return;
  isPanning = true;
  startX = e.clientX; startY = e.clientY;
  startTx = tx; startTy = ty;
  area.setPointerCapture(e.pointerId);
});
area.addEventListener('pointermove', e => {
  if (!isPanning) return;
  tx = startTx + (e.clientX - startX);
  ty = startTy + (e.clientY - startY);
  applyTransform();
});
area.addEventListener('pointerup', () => { isPanning = false; });
area.addEventListener('pointercancel', () => { isPanning = false; });

// Mouse wheel zoom
area.addEventListener('wheel', e => {
  e.preventDefault();
  const factor = e.deltaY < 0 ? 1.15 : 0.87;
  const rect = area.getBoundingClientRect();
  const mx = e.clientX - rect.left, my = e.clientY - rect.top;
  const newScale = Math.max(0.1, Math.min(20, scale * factor));
  tx = mx - (mx - tx) * (newScale / scale);
  ty = my - (my - ty) * (newScale / scale);
  scale = newScale;
  applyTransform();
}, { passive: false });

// Touch pinch zoom
let touches = [];
area.addEventListener('touchstart', e => {
  touches = Array.from(e.touches);
  if (touches.length === 2) {
    e.preventDefault();
    isPanning = false;
    lastPinchDist = Math.hypot(touches[1].clientX - touches[0].clientX, touches[1].clientY - touches[0].clientY);
    pinchStartScale = scale;
    startTx = tx; startTy = ty;
  }
}, { passive: false });
area.addEventListener('touchmove', e => {
  if (e.touches.length === 2) {
    e.preventDefault();
    const t = Array.from(e.touches);
    const dist = Math.hypot(t[1].clientX - t[0].clientX, t[1].clientY - t[0].clientY);
    const rect = area.getBoundingClientRect();
    const cx = (t[0].clientX + t[1].clientX) / 2 - rect.left;
    const cy = (t[0].clientY + t[1].clientY) / 2 - rect.top;
    const newScale = Math.max(0.1, Math.min(20, pinchStartScale * (dist / lastPinchDist)));
    tx = cx - (cx - startTx) * (newScale / pinchStartScale);
    ty = cy - (cy - startTy) * (newScale / pinchStartScale);
    scale = newScale;
    applyTransform();
  }
}, { passive: false });

async function renderDiagram(name) {
  if (svgCache[name]) return svgCache[name];
  const { svg } = await mermaid.render('mermaid-' + name, definitions[name]);
  const wrapper = document.createElement('div');
  wrapper.innerHTML = svg;
  const svgEl = wrapper.querySelector('svg');
  svgEl.style.position = 'absolute';
  svgEl.style.top = '0';
  svgEl.style.left = '0';
  svgEl.removeAttribute('width');
  svgEl.removeAttribute('height');
  // Set explicit pixel size from viewBox so transform works predictably
  const vb = svgEl.viewBox.baseVal;
  svgEl.setAttribute('width', vb.width);
  svgEl.setAttribute('height', vb.height);
  svgCache[name] = svgEl;
  return svgEl;
}

window.showTab = async function(name) {
  document.getElementById('btn-arteries').className = name === 'arteries' ? 'active-art' : '';
  document.getElementById('btn-veins').className = name === 'veins' ? 'active-vein' : '';
  document.getElementById('loading-msg')?.classList.remove('hidden');

  const svgEl = await renderDiagram(name);

  // Clear area (keep controls outside)
  area.querySelectorAll('svg, .loading').forEach(el => el.remove());
  area.appendChild(svgEl);
  currentSvg = svgEl;
  scale = 1; tx = 0; ty = 0;
  // Wait a frame for layout, then fit
  requestAnimationFrame(() => fitToView());
};

// Start
showTab('arteries');
</script>

</body>
</html>
